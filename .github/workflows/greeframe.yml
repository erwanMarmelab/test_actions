run-name: "greenframe official GitHub-Action"
on: [push]

jobs:
  greenframe_action_workflow:
    runs-on: ubuntu-latest
    name: Run a GreenFrame CLI Action
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Start database
        run: |
          docker run --name postgres-db -e POSTGRES_PASSWORD=docker -p 5867:5867 -d postgres
          echo "------------------------------------------"
          docker ps
      - name: Start project
        run: |
          make install-app
          make start-app &
      - name: GreenFrame Analysis
        env:
          GREENFRAME_SECRET_TOKEN: dd9226f13ec6ee83cff9aa77620eaae914bd32fb
        run :
          curl https://assets.greenframe.io/install.sh | bash
          API_URL="https://localhost:3006" greenframe analyze -C ./.greenframe.yml
